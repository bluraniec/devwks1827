## Chapter 3.2 - SERVICE CREATION (XML TEMPLATE)
> Time to work on our ACL_SERVICE skeleton! :boom:  
> First - XML Template! :construction_worker:

First part is an XML template of our Service - this is going to be a real config pushed to the devices.  
In this chapter, we're going to work on **ACL_SERVICE-template.xml** file.  

<img src="/readme/temp.png"></img>

Let's take a look on this file - this is an initial XML template generated by default: <br>
<p align="center">
<img width=460 src="/readme/xml_init.png"></img>
</p>

**{ }** content between curly brackets indicates a **variable** that will be derived as a Service input during its creation 

In this initial XML template, we're going to put our ACLs configs between **<config\>** tags - which will be pushed then to the particular inputted device indicated by **{/device}**

### 1st step - Log in back to NSO:
```
ncs_cli -C -u admin
```

### 2nd step - Go into config mode:
```
config
```

### 3rd step - Put sample IOS config on NSO CLI:
```
devices device IOS0 config ios:ip access-list standard ACL_CLUS
permit 172.16.0.0 0.0.255.255
deny 192.168.34.0 0.0.0.255
top
devices device IOS0 config ios:interface GigabitEthernet 0/0
ip access-group ACL_CLUS in
```

### 4th step - Generate XML from inputted configuration:
```
commit dry-run outformat xml
```

### 5th step - Copy-paste to ACL_SERVICE-template.xml:
Copy all output between **<config\>** **</config\>** tags from the CLI and paste it to our initial XML template **ACL_SERVICE-template.xml** as well between **<config\>** **</config\>** tags:
<img src="init temp.png"></img>

### 6th step - Abort configuration of IOS device
Great! We only wanted to generate the structure of XML. Don't commit that configuration to the device, abort it:
```
admin@ncs(config-if)# abort
```

### 7th step - Go back into config mode:
```
admin@ncs# config
```

### 8th step - Repeat above steps for IOS-XR:
```
devices device IOS_XR0 config cisco-ios-xr:ipv4 access-list ACL_CLUS
10 permit 172.16.0.0 0.0.255.255
20 deny 192.168.34.0 0.0.0.255
top
devices device IOS_XR0 config cisco-ios-xr:interface GigabitEthernet 0/0
ipv4 access-group ACL_CLUS ingress
```
Remember to `abort` after copying the content from `commit dry-run outformat xml` output and only after that go again to the `config` mode!

### 9th step - Repeat above steps for Juniper:
```
devices device JUN0 config junos:configuration firewall family inet filter ACL_CLUS 
term 10 from source-address 172.16.0.0/16
exit
then accept
exit
term 20 from source-address 192.168.34.0/24
exit
then reject
top
devices device JUN0 config junos:configuration interfaces interface xe-0/0/0 unit 0 family inet filter input filter-name ACL_CLUS
```
Remember to `abort` after copying the content from `commit dry-run outformat xml` output and only after that go again to the `config` mode!

### 10th step - Draft done:
Once you're done - the complete template **ACL_SERVICE-template.xml** with our ACL configs for IOS, IOS-XR and JUNIPER should looks like that (with configs for all vendors pasted one by one):
<p align="center">
<img width=640 src="/readme/template_full.png"></img>
</p>

Congratz! You have prepared all devices configuration for our Service! But wait... there're now fixed values. 

### 11th step - Parametrize it:
Let's update the template with our parametrized **variables** from the previous Chapter - **interface** and **direction**!

Parameter | IOS  | IOS-XR | Junos
------------ | ------------- | ------------- | -------------
interface | `[int]` | `[int]` | `[int]`
direction | `[in/out]` | `[ingress/egress]` | `[input/output]`  

As per what we have designed - we want to unify **direction** parameter to keep it only as **in/out** for all types of devices.

Let's start from **IOS**. Based on our table we're passing there **{/ios/interface}** parameter (which will later on take GigabitEthernet interface values) and **{/ios/direction}** parameter (which is going to be then **in** our **out**) :
<img src="/readme/iosparam.png"></img>

For **IOS-XR** we could easily pass ingress and egress values directly as a parameter of {/ios-xr/direction} but to have it unified to in/out - it requires a little bit different change. 

To activate part of the template responsible for **ingress** configuration, we're going to use **when statement**. We need to do the same for **egress**.

<img src="/readme/xrparam.png"></img>

For **Juniper** we could as well easily pass input and output values directly as a parameter of {/junos/direction} but to have it unified to in/out - it requires a similar change to IOS-XR. 

The difference is that **direction** here is not a value (like 'input'/'output') - it's an **XML tag**, so you need to use **when statement** there to be able to activate the particular, desired tag:
<img src="/readme/junparam.png"></img>

That's it, we're done with template creation! Congratz!

<h4 align="center">[7/12]</h4>
<h4 align="center"> <a href="/readme/5.md"> :arrow_left: Create Service Skeleton! </a> || <a href="/readme/5b.md"> Create Service YANG Data Model! :arrow_right: </a> </h4>
