## 5th step - CUSTOM UI
> You can create your own applications on top of NSO!  
> Sky is the limit! :partly_sunny:

By the usage of **RESTCONF** protocol, you can build various apps on top of NSO that will be called via REST operations like GET/POST/PATCH/PUT/DELETE.

This opens many possibilities... 

For example - Network Engineers are comfortable with the CLI but Customers doesn't really want to see the CLI in the XXI century. They would love to see customized User Interface and be able to configure network by clicking the button in the website.

In Carl scenario - when he will be on his PTO - there will be no one in his company with enough networking knowledge to remove ACL_CLUS from the whole network of different devices :( Let's help them and create a Button that will remove after one-click all ACL_CLUS configs from all devices in the Network!

This is the design of our Custom Web UI:
<img src="/readme/ui1.png"></img>

Lab has already pre-prepared functionalities like:
- **Show devices** - shows devices onboarded in NSO (device, address, port, platform)
- **Get ACLs** - shows deployed ACLs by the ACL_SERVICE (device, interface, direction)
- **Set ACLs** - form to deploy ACL_SERVICE (device, interface, direction)

We're going to implement:
- **Delete ACLs** - removes from the whole network all configs deployed by ACL_SERVICE instances

Django project skeleton structure is automatically generated and looks following:
```
/nso-ui
├── Dockerfile
├── requirements.txt
├── manage.py
├── portal
    ├── settings.py
    ├── urls.py
    ├── wsgi.py
    └── __init__.py
└── app
    ├── admin.py
    ├── apps.py
    ├── models.py
    ├── tests.py
    ├── views.py
    ├── migrations
    └── templates
        ├── show_devices.html
        ├── get_ACLs.html
        ├── set_ACLs.html
        ├── set_ACLs_submit.html
        └── message.html
```

Important to you are following files:
- /portal/urls.py
- /app/views.py
- /app/templates/index.html

### 1st step - Review portal functionality
Go to http://localhost:8990/ and check basic functionality of the custom UI portal.

Show Devices:
<img src="/readme/ui2.png"></img>

Get ACLs:
<img src="/readme/ui3.png"></img>

Set ACLs[1]:
<img src="/readme/ui4.png"></img>

Set ACLs[2]:
<img src="/readme/ui5.png"></img>

### 2nd step - Find out how does it work - urls.py
In urls.py you have function bindings with proper URLs. 
Corresponding function will be triggered once URL accessed:
```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('', views.show_devices, name='show_devices'),
    path('get_ACLs/', views.get_ACLs, name='get_ACLs'),
    path('set_ACLs/', views.set_ACLs, name='set_ACLs'),
    path('set_ACLs_submit/', views.set_ACLs_submit, name='set_ACLs_submit')
]
```
So it means that if you access:  
http://localhost:8990/get_ACLs/ - function **get_ACLs()** from views.py will be executed  
http://localhost:8990/set_ACLs/ - function **set_ACLs()** from views.py will be executed  

### 3rd step - Find out how does it work - views.py
Here are our above-mentioned functions. 
The main purpose of these functions is to execute a **RESTCONF Request** to the NSO and pass Response to the **HTML template** to render it. 
```python
response = requests.get("http://172.16.238.2:8080/restconf/data/"+url, 
                        auth=('admin', 'admin'), 
                        headers={'Content-type':'application/yang-data+json', 
                                 'Accept':'application/yang-data+json'}).json()
```

### 4th step - Find out how does it work - templates/show_devices.html:
We have passed in the previous step response as a **devices** variable to the HTML template. 
Let's now access this value and render it in a table:
```html
<h1>DEVNET Workshop #1827 - Demystifying NSO</h1>
<br>
<table class="table">
  <thead class="thead-dark">
    <tr>
      <th scope="col">DEVICE</th>
      <th scope="col">ADDRESS</th>
      <th scope="col">PORT</th>
      <th scope="col">TYPE</th>
    </tr>
  </thead>
  <tbody>
  {% for device_name, address, port, device_type in devices %}
    <tr>
      <th scope="row">{{ device_name }}</th>
      <td>{{ address }}</td>
      <td>{{ port }}</td>
      <td>{{ device_type }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
```

### 5th step - Create Delete ACLs functionality
Add delete_ACLs to the urls.py:
```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('', views.show_devices, name='show_devices'),
    path('delete_ACLs/', views.delete_ACLs, name='delete_ACLs'),
    path('get_ACLs/', views.get_ACLs, name='get_ACLs'),
    path('set_ACLs/', views.set_ACLs, name='set_ACLs'),
    path('set_ACLs_submit/', views.set_ACLs_submit, name='set_ACLs_submit')
]
```
Save it!

Add new function in the end of views.py
```python
def delete_ACLs(request):
	response = requests.delete("http://172.16.238.2:8080/restconf/data/ACL_SERVICE",
                            auth=('admin', 'admin'), 
                            headers={'Content-type':'application/yang-data+json', 
                                     'Accept':'application/yang-data+json'})
	template = loader.get_template('message.html')
	return HttpResponse(template.render({'response':response}, request))
 ```
Save it!
 
Render the output in HTML template below the title in message.html:
```html
<br>
<h1>DEVNET Workshop #1827 - Demystifying NSO</h1>
<br>
<p>{{ response }} </p>
```
Save it!

---
<h4 align="center">[11/12]</h4>
<h4 align="center"> <a href="/readme/6.md"> :arrow_left: Service Deployment! </a> || <a href="/readme/8.md"> Summary! :arrow_right: </a> </h4>
